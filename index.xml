<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Loghin Alexandru</title><link>https://loghinalexandru.com/</link><description>Recent content on Loghin Alexandru</description><generator>Hugo -- gohugo.io</generator><language>en</language><managingEditor>alex.loghin@outlook.com (Loghin Alexandru)</managingEditor><webMaster>alex.loghin@outlook.com (Loghin Alexandru)</webMaster><copyright>Copyright Â© 2022 Loghin Alexandru | Powered By Hugo</copyright><lastBuildDate>Mon, 12 Dec 2022 10:39:46 +0200</lastBuildDate><atom:link href="https://loghinalexandru.com/index.xml" rel="self" type="application/rss+xml"/><item><title>CoreDNS AdBlock</title><link>https://loghinalexandru.com/ledger/coredns-adblock/</link><pubDate>Mon, 12 Dec 2022 10:39:46 +0200</pubDate><author>alex.loghin@outlook.com (Loghin Alexandru)</author><guid>https://loghinalexandru.com/ledger/coredns-adblock/</guid><description>
&lt;h1 id="why">
Why
&lt;a href="#why" class="h-anchor" aria-hidden="true">#&lt;/a>
&lt;/h1>
&lt;p>There are a lot of popular ad-blocking software out there. To name a few, &lt;a href="https://pi-hole.net/">Pihole&lt;/a> &amp;amp; &lt;a href="https://adguard.com/en/welcome.html">AdGuard&lt;/a> are the most popular ones.&lt;/p>
&lt;p>However they do come with an UI and they are generally not that fast. Deploying them will consume a lot of memory for which I do not have the resources in the first place and the scaling of these solutions also means adding the UI into the mix.&lt;/p>
&lt;p>Que my solution with automatic initialization &amp;amp; updating of a &lt;em>hosts&lt;/em> blacklist file with resources specifiable via the values file in helm.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># Use this as a hosts file to set custom DNS records&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">customRecords&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">192.168.1.33&lt;/span> &lt;span style="color:#ae81ff">some-service.home&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># The lists must be the same format as a hosts file&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">blockListUrls&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="features">
Features
&lt;a href="#features" class="h-anchor" aria-hidden="true">#&lt;/a>
&lt;/h1>
&lt;ul>
&lt;li>&lt;input checked="" disabled="" type="checkbox"> Self contained instance with no need for a storage solution (it uses an emptyDir volume).&lt;/li>
&lt;li>&lt;input checked="" disabled="" type="checkbox"> Initialization container that makes sure we have the &lt;em>hosts&lt;/em> file in place.&lt;/li>
&lt;li>&lt;input checked="" disabled="" type="checkbox"> Custom container that runs a cronjob to update the &lt;em>hosts&lt;/em> file every 24 hours.&lt;/li>
&lt;li>&lt;input checked="" disabled="" type="checkbox"> Fast &amp;amp; scalable with no bloatware.&lt;/li>
&lt;li>&lt;input checked="" disabled="" type="checkbox"> Easy to deploy via &lt;a href="https://helm.sh/">Helm&lt;/a>.&lt;/li>
&lt;/ul>
&lt;h1 id="default-values">
Default values
&lt;a href="#default-values" class="h-anchor" aria-hidden="true">#&lt;/a>
&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">replicaCount&lt;/span>: &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">service&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">type&lt;/span>: &lt;span style="color:#ae81ff">LoadBalancer&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># Use this as a hosts file to set custom DNS records&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">customRecords&lt;/span>: []
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># The lists must be the same format as a hosts file&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">blockListUrls&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">emptyDir&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">size&lt;/span>: &lt;span style="color:#ae81ff">100M&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">resources&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">coredns&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">limits&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">memory&lt;/span>: &lt;span style="color:#ae81ff">65Mi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">requests&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">cpu&lt;/span>: &lt;span style="color:#ae81ff">100m&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">memory&lt;/span>: &lt;span style="color:#ae81ff">65Mi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">blacklistRunner&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">limits&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">memory&lt;/span>: &lt;span style="color:#ae81ff">20Mi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">requests&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">cpu&lt;/span>: &lt;span style="color:#ae81ff">50m&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">memory&lt;/span>: &lt;span style="color:#ae81ff">20Mi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">autoscaling&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">minReplicas&lt;/span>: &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">maxReplicas&lt;/span>: &lt;span style="color:#ae81ff">3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">targetCPUUtilizationPercentage&lt;/span>: &lt;span style="color:#ae81ff">65&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>If you want to override this make a custom-values.yaml add pass it via &lt;strong>-f&lt;/strong> to helm. Make note that you might want to use a &lt;strong>LoadBalancer&lt;/strong> for this since the NodePort option does not allow to use port &lt;strong>53&lt;/strong> since it is not in the default range for k8s.&lt;/p>
&lt;h1 id="how-to-install">
How to install
&lt;a href="#how-to-install" class="h-anchor" aria-hidden="true">#&lt;/a>
&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>git clone https://github.com/loghinalexandru/coredns-adblock
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>helm upgrade --install coredns-adblock ./coredns-adblock
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item></channel></rss>